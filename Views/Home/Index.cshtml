@{
    Layout = null;
}

<!DOCTYPE html>
<html data-bs-theme="light" lang="en-US" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- ===============================================-->
    <!--    Document Title-->
    <!-- ===============================================-->
    <title>Ganador | Schad</title>

    <!-- ===============================================-->
    <!--    Favicons-->
    <!-- ===============================================-->
    <meta name="theme-color" content="#1e2e48">
    <script src="~/assets/js/config.js" asp-append-version="true"></script>
    <script src="~/vendors/simplebar/simplebar.min.js" asp-append-version="true"></script>

    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700%7cPoppins:300,400,500,600,700,800,900&amp;display=swap" rel="stylesheet">
    <link href="~/vendors/simplebar/simplebar.min.css" rel="stylesheet" asp-append-version="true">
    <link href="~/assets/css/theme-rtl.css" rel="stylesheet" id="style-rtl" asp-append-version="true">
    <link href="~/assets/css/theme.css" rel="stylesheet" id="style-default" asp-append-version="true">
    <link href="~/assets/css/user-rtl.css" rel="stylesheet" id="user-style-rtl" asp-append-version="true">
    <link href="~/assets/css/user.css" rel="stylesheet" id="user-style-default" asp-append-version="true">
    <script asp-append-version ="true">
        var isRTL = JSON.parse(localStorage.getItem('isRTL'));
        if (isRTL) {
            var linkDefault = document.getElementById('style-default');
            var userLinkDefault = document.getElementById('user-style-default');
            linkDefault.setAttribute('disabled', true);
            userLinkDefault.setAttribute('disabled', true);
            document.querySelector('html').setAttribute('dir', 'rtl');
        } else {
            var linkRTL = document.getElementById('style-rtl');
            var userLinkRTL = document.getElementById('user-style-rtl');
            linkRTL.setAttribute('disabled', true);
            userLinkRTL.setAttribute('disabled', true);
        }
    </script>
</head>


<body>

    <!-- ===============================================-->
    <!--    Main Content-->
    <!-- ===============================================-->
    <main class="main" id="top">
        <div class="container-fluid">
            <div class="row min-vh-100 flex-center g-0">
                <div class="col-lg-8 col-xxl-5 py-3 position-relative">
                    <div class="card overflow-hidden z-1">
                        <div class="card-body p-0">
                            <div class="row g-0 h-100">
                                <div class="col-md-5 d-flex">
                                    <img src="../../../assets/img/RIFA.png" alt="" class="fill" />
                                </div>
                                <div class="col-md-7 d-flex flex-center">
                                    <div class="p-4 p-md-5 flex-grow-1">
                                        <div id="timer" class="bg-holder invisible">
                                            <div class="lottie mx-auto" style="width: 100%; height: 190px;" data-options='{"path":"../../../assets/img/animated-icons/timer.json"}'></div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button id="btnGetWinner" class="btn btn-danger d-block w-100 mt-3 btn-lg" type="button"><i class="fa fas fa-medal"></i> Obtener Ganador</button>
                                            <span id="msnEnd" class="text-danger text-bold fs-2"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="modal fade" id="staticBackdrop" data-bs-keyboard="false" data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg mt-10" role="document">
                    <div class="modal-content border-0">
                        <div class="modal-body p-0">
                            <div class="bg-body-tertiary">
                                <div class="bg-holder d-lg-block">
                                    <div class="lottie mx-auto" style="width: 100%; height: 450px;position:absolute;" data-options='{"path":"../../../assets/img/animated-icons/confetti.json"}'></div>
                                    <div class="lottie mx-auto" style="width: 100%; height: 80px;position:relative;" data-options='{"path":"../../../assets/img/animated-icons/medalla.json"}'></div>
                                </div>
                            </div>
                            <div class="col-lg-12 px-3 py-3 pt-7">
                                <div class="row text-center">
                                    <input id="empId" type="hidden" name="empId" />
                                    <input id="awardId" type="hidden" name="awardId" />
                                    <strong class="text-primary text-bold fs-4" id="nombreApellido"></strong>
                                    <span class="text-warning text-bold fs-4" id="sequence"></span><span class="text-success text-bold fs-4" id="amount"></span>
                                    <span class="text-info text-bold fs-2">¡Felicidades!</span>
                                </div>
                            </div>
                        </div>
                        <div class="position-absolute bottom-0 end-0 me-3 mb-3 z-1">
                            <button id="close" class="btn btn-outline-success rounded-pill me-1 mb-1" data-bs-dismiss="modal" aria-label="Confirmar">
                                <i class="far fa-smile"></i>
                            </button>
                            <button id="cancel" class="btn btn-outline-secondary rounded-pill me-1 mb-1" data-bs-dismiss="modal" aria-label="Cancel">
                                <i class="far fa-tired"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- ===============================================-->
    <!--    End of Main Content-->
    <!-- ===============================================-->

    <!-- ===============================================-->
    <!--    JavaScripts-->
    <!-- ===============================================-->
    <script src="~/vendors/popper/popper.min.js" asp-append-version="true"></script>
    <script src="~/vendors/bootstrap/bootstrap.min.js" asp-append-version="true"></script>
    <script src="~/vendors/anchorjs/anchor.min.js" asp-append-version="true"></script>
    <script src="~/vendors/is/is.min.js" asp-append-version="true"></script>
    <script src="~/vendors/fontawesome/all.min.js" asp-append-version="true"></script>
    <script src="~/vendors/lodash/lodash.min.js" asp-append-version="true"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
    <script src="~/vendors/list.js/list.min.js" asp-append-version="true"></script>
    <script src="~/assets/js/theme.js" asp-append-version="true"></script>
    <script src="~/vendors/lottie/lottie.min.js" asp-append-version="true"></script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(function () {
            const timer = document.getElementById('timer');
            const btnGetWinner = document.getElementById('btnGetWinner');
            const btnCloseModal = document.getElementById('close');
            const nombreApellido = document.getElementById('nombreApellido');
            const empId = document.getElementById('empId');
            const awardId = document.getElementById('awardId');
            const amount = document.getElementById('amount');
            const msnEnd = document.getElementById('msnEnd');
            const sequence = document.getElementById('sequence');
            const btnCancel = document.getElementById('cancel');

            btnGetWinner.addEventListener("click", function () {
                if (timer.classList.value == 'bg-holder invisible') {
                    timer.classList.remove("invisible");
                    timer.classList.add("visible");
                    setTimeout(function () {
                        timer.classList.remove("visible");
                        timer.classList.add("invisible");

                        setTimeout(function () {
                            $.ajax({
                                type: 'POST',
                                url: '@Url.Action("GetWinner", "Home")',
                                dataType: 'JSON',
                                contentType: 'application/json',
                                success: function (res) {
                                    if (res.award.data.length > 0) {
                                        JSON.stringify({ res });
                                        //console.log(res);
                                        nombreApellido.innerHTML = res.winner.data[0].Nombres + ' ' + res.winner.data[0].Apellidos;
                                        empId.value = res.winner.data[0].EmpleadoID;
                                        awardId.value = res.award.data[0].ID;
                                        sequence.innerHTML = "#" + res.award.data[0].Sequence;
                                        amount.innerHTML = res.award.data[0].Amount;
                                        $('#staticBackdrop').modal('show');
                                    }
                                    else {
                                        btnGetWinner.disabled = true;
                                        msnEnd.innerHTML = "FIN";
                                    }
                                },
                                error: function (xhr, ajaxOptions, thrownError) {
                                    console.log(xhr.responseText);
                                }
                            });
                        }, 500);
                    }, 3000);
                }
            }, true);

            btnCloseModal.addEventListener("click", function () {
                if (empId.value !== null) {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("SetWinner", "Home")',
                        data: { EmpleadoID: empId.value, AwardId: awardId.value },
                        success: function (data) {
                            window.location.reload();
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            console.log(xhr.responseText);
                        }
                    });
                }
            }, false);

            btnCancel.addEventListener("click", function () {
                if (empId.value !== null) {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("OutWinner", "Home")',
                        data: { EmpleadoID: empId.value },
                        success: function (data) {
                            window.location.reload();
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            console.log(xhr.responseText);
                        }
                    });
                }
            }, false)

        });
    </script>
</body>

</html>